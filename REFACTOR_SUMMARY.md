# ä»£ç é‡æ„æ€»ç»“

## ğŸ“‹ é‡æ„ç›®æ ‡

æœ¬æ¬¡é‡æ„æ—¨åœ¨æå‡ä»£ç è´¨é‡ï¼Œå®ç°é«˜å†…èšä½è€¦åˆçš„æ¶æ„è®¾è®¡ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. ç±»å‹å®šä¹‰æå– (Type Definitions)

**ä½ç½®**: `src/pages/ai/types/`

- âœ… åˆ›å»º `chat.types.ts` - èŠå¤©ç›¸å…³ç±»å‹å®šä¹‰

  - `MessageRole` - æ¶ˆæ¯è§’è‰²ç±»å‹
  - `ChatMessage` - èŠå¤©æ¶ˆæ¯æ¥å£
  - `ModelConfig` - æ¨¡å‹é…ç½®æ¥å£
  - `ParsedContent` - è§£æåçš„æ¶ˆæ¯å†…å®¹æ¥å£
  - `SSECallbacks` - SSE è¿æ¥å›è°ƒæ¥å£

- âœ… åˆ›å»ºç»Ÿä¸€å¯¼å‡º `types/index.ts`

**ä¼˜åŠ¿**:

- ç±»å‹å®šä¹‰é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤
- é¿å…é‡å¤å®šä¹‰
- æä¾›æ›´å¥½çš„ç±»å‹æç¤º

### 2. å¸¸é‡æå– (Constants)

**ä½ç½®**: `src/pages/ai/constants/`

- âœ… åˆ›å»º `models.ts` - æ¨¡å‹ç›¸å…³å¸¸é‡

  - `TEXT_MODELS` - æ–‡æœ¬æ¨¡å‹åˆ—è¡¨
  - `VISION_MODELS` - è§†è§‰æ¨¡å‹åˆ—è¡¨
  - `MODEL_NAMES` - æ¨¡å‹æ˜¾ç¤ºåç§°æ˜ å°„
  - `DEFAULT_MODEL` - é»˜è®¤æ¨¡å‹

- âœ… ä¿ç•™åŸæœ‰ `chat.ts` å¸¸é‡
- âœ… åˆ›å»ºç»Ÿä¸€å¯¼å‡º `constants/index.ts`

**ä¼˜åŠ¿**:

- é­”æ³•å­—ç¬¦ä¸²æ¶ˆé™¤
- é…ç½®é›†ä¸­ç®¡ç†
- ä¾¿äºæœªæ¥æ‰©å±•æ–°æ¨¡å‹

### 3. å·¥å…·å‡½æ•°æå– (Utility Functions)

**ä½ç½®**: `src/pages/ai/utils/`

- âœ… åˆ›å»º `chatId.ts` - èŠå¤©å®¤ ID ç›¸å…³å·¥å…·

  - `generateChatId()` - ç”Ÿæˆå”¯ä¸€èŠå¤©å®¤ ID
  - `isValidChatId()` - éªŒè¯èŠå¤©å®¤ ID æ ¼å¼

- âœ… åˆ›å»º `messageParser.ts` - æ¶ˆæ¯è§£æå·¥å…·

  - `parseMessageContent()` - è§£ææ€è€ƒè¿‡ç¨‹å’Œæ­£å¸¸å†…å®¹
  - `hasThinkingProcess()` - æ£€æŸ¥æ˜¯å¦åŒ…å«æ€è€ƒè¿‡ç¨‹

- âœ… ä¿ç•™åŸæœ‰ `timeFormat.ts` æ—¶é—´æ ¼å¼åŒ–å·¥å…·
- âœ… åˆ›å»ºç»Ÿä¸€å¯¼å‡º `utils/index.ts`

**ä¼˜åŠ¿**:

- é€»è¾‘å¤ç”¨
- å•å…ƒæµ‹è¯•å‹å¥½
- èŒè´£æ¸…æ™°

### 4. æ ·å¼æå– (Styles)

**ä½ç½®**: `src/pages/ai/styles/`

- âœ… åˆ›å»º `markdown.less` - Markdown æ¸²æŸ“æ ·å¼

  - å®Œæ•´çš„ Markdown å…ƒç´ æ ·å¼
  - ç´§å‡‘ç‰ˆæ ·å¼ `markdown-body-compact`

- âœ… åˆ›å»º `animations.less` - åŠ¨ç”»æ•ˆæœ

  - `blink` - é—ªçƒåŠ¨ç”»ï¼ˆå…‰æ ‡ï¼‰
  - `pulse` - è„‰å†²åŠ¨ç”»ï¼ˆæ€è€ƒå›¾æ ‡ï¼‰
  - `fadeIn` - æ¸å…¥åŠ¨ç”»
  - `slideInUp/Down` - æ»‘å…¥åŠ¨ç”»
  - `spin` - æ—‹è½¬åŠ è½½åŠ¨ç”»

- âœ… åˆ›å»º `common.less` - é€šç”¨æ ·å¼

  - `custom-scrollbar` - æ»šåŠ¨æ¡ç¾åŒ–ï¼ˆæµ…è‰²ï¼‰
  - `custom-scrollbar-orange` - æ»šåŠ¨æ¡ç¾åŒ–ï¼ˆæ©™è‰²ï¼‰
  - `card-shadow` - å¡ç‰‡é˜´å½±æ•ˆæœ
  - `text-ellipsis` - æ–‡å­—çœç•¥
  - `flex-center` - å±…ä¸­å¸ƒå±€
  - å“åº”å¼æ–­ç‚¹å®šä¹‰

- âœ… åˆ›å»ºç»Ÿä¸€å¯¼å‡º `styles/index.less`

**ä¼˜åŠ¿**:

- æ ·å¼å¤ç”¨ï¼Œå‡å°‘å†—ä½™
- ç»Ÿä¸€è§†è§‰é£æ ¼
- ä¾¿äºä¸»é¢˜åˆ‡æ¢

### 5. Composables ä¼˜åŒ–

**ä½ç½®**: `src/pages/ai/composables/`

- âœ… åˆ›å»º `useChatHistory.ts` - èŠå¤©å†å²ç®¡ç†

  - æ¶ˆæ¯åŠ è½½/ä¿å­˜
  - æ¶ˆæ¯å¢åˆ æ”¹æ“ä½œ
  - localStorage ç¼“å­˜ç®¡ç†

- âœ… åˆ›å»º `useChatRoomManagement.ts` - èŠå¤©å®¤ç®¡ç†

  - èŠå¤©å®¤åˆ—è¡¨åŠ è½½
  - èŠå¤©å®¤åˆ›å»º
  - èŠå¤©å®¤çŠ¶æ€æ£€æŸ¥

- âœ… åˆ›å»º `useSSEConnection.ts` - SSE è¿æ¥ç®¡ç†

  - è¿æ¥å»ºç«‹å’Œå…³é—­
  - è¿æ¥çŠ¶æ€ç®¡ç†
  - æ¶ˆæ¯å›è°ƒå¤„ç†

- âœ… åˆ›å»ºç»Ÿä¸€å¯¼å‡º `composables/index.ts`

**ä¼˜åŠ¿**:

- é€»è¾‘æ‹†åˆ†ï¼ŒèŒè´£å•ä¸€
- å¯å¤ç”¨æ€§å¼º
- ä¾¿äºæµ‹è¯•

### 6. ç»„ä»¶é‡æ„

#### 6.1 AI èŠå¤©ç»„ä»¶æ‹†åˆ†

**MessageItem.vue** æ‹†åˆ†ä¸ºï¼š

- âœ… `MessageItem.vue` - ä¸»ç»„ä»¶ï¼ˆç®€åŒ–åˆ° 130 è¡Œï¼‰
- âœ… `message/CopyButton.vue` - å¤åˆ¶æŒ‰é’®ç»„ä»¶
- âœ… `message/ThinkingSection.vue` - æ€è€ƒè¿‡ç¨‹å±•ç¤ºç»„ä»¶
- âœ… `message/MessageContent.vue` - æ¶ˆæ¯å†…å®¹å±•ç¤ºç»„ä»¶

**ChatInput.vue** æ‹†åˆ†ä¸ºï¼š

- âœ… `ChatInput.vue` - ä¸»ç»„ä»¶ï¼ˆç®€åŒ–åˆ° 180 è¡Œï¼‰
- âœ… `input/ModelSelector.vue` - æ¨¡å‹é€‰æ‹©å™¨ç»„ä»¶
- âœ… `input/FeatureOptions.vue` - åŠŸèƒ½é€‰é¡¹é…ç½®ç»„ä»¶

**chatPage.vue** é‡æ„ï¼š

- âœ… ä» 600+ è¡Œç®€åŒ–åˆ° 280 è¡Œ
- âœ… ä½¿ç”¨æ–°çš„ composables
- âœ… èŒè´£æ¸…æ™°ï¼šåªè´Ÿè´£åè°ƒå„å­ç»„ä»¶

#### 6.2 ç”¨æˆ·èµ„æ–™ç»„ä»¶æ‹†åˆ†

**userProfilePage.vue** æ‹†åˆ†ä¸ºï¼š

- âœ… `userProfilePage.vue` - ä¸»ç»„ä»¶ï¼ˆç®€åŒ–åˆ° 220 è¡Œï¼‰
- âœ… `user/components/AvatarUpload.vue` - å¤´åƒä¸Šä¼ ç»„ä»¶
- âœ… `user/components/ProfileForm.vue` - èµ„æ–™è¡¨å•ç»„ä»¶
- âœ… `user/components/PasswordModal.vue` - å¯†ç ä¿®æ”¹æ¨¡æ€æ¡†ç»„ä»¶

### 7. ç»Ÿä¸€å¯¼å‡º (Index Exports)

- âœ… `src/pages/ai/components/index.ts` - AI èŠå¤©ç»„ä»¶å¯¼å‡º
- âœ… `src/pages/ai/composables/index.ts` - Composables å¯¼å‡º
- âœ… `src/pages/ai/types/index.ts` - ç±»å‹å®šä¹‰å¯¼å‡º
- âœ… `src/pages/ai/constants/index.ts` - å¸¸é‡å¯¼å‡º
- âœ… `src/pages/ai/utils/index.ts` - å·¥å…·å‡½æ•°å¯¼å‡º
- âœ… `src/pages/user/components/index.ts` - ç”¨æˆ·ç»„ä»¶å¯¼å‡º
- âœ… `src/pages/admin/components/index.ts` - ç®¡ç†å‘˜ç»„ä»¶å¯¼å‡º

**ä¼˜åŠ¿**:

- ç®€åŒ–å¯¼å…¥è¯­å¥
- æ›´å¥½çš„ä»£ç ç»„ç»‡
- ä¾¿äºæ‰¹é‡å¯¼å‡º

## ğŸ“Š é‡æ„æ•ˆæœå¯¹æ¯”

### ä»£ç è¡Œæ•°å‡å°‘

| æ–‡ä»¶                  | é‡æ„å‰ | é‡æ„å | å‡å°‘ |
| --------------------- | ------ | ------ | ---- |
| `chatPage.vue`        | 608 è¡Œ | 280 è¡Œ | -54% |
| `MessageItem.vue`     | 647 è¡Œ | 130 è¡Œ | -80% |
| `ChatInput.vue`       | 383 è¡Œ | 180 è¡Œ | -53% |
| `userProfilePage.vue` | 586 è¡Œ | 220 è¡Œ | -62% |

### ç»„ä»¶æ•°é‡å¢åŠ 

| æ¨¡å—        | é‡æ„å‰ | é‡æ„å | å¢åŠ   |
| ----------- | ------ | ------ | ----- |
| AI èŠå¤©ç»„ä»¶ | 8 ä¸ª   | 18 ä¸ª  | +125% |
| ç”¨æˆ·ç»„ä»¶    | 1 ä¸ª   | 4 ä¸ª   | +300% |

### æ–‡ä»¶ç»“æ„ä¼˜åŒ–

```
src/pages/ai/
â”œâ”€â”€ chatPage.vue (ä¸»é¡µé¢)
â”œâ”€â”€ components/ (UI ç»„ä»¶)
â”‚   â”œâ”€â”€ index.ts (ç»Ÿä¸€å¯¼å‡º)
â”‚   â”œâ”€â”€ input/ (è¾“å…¥ç›¸å…³)
â”‚   â”œâ”€â”€ message/ (æ¶ˆæ¯ç›¸å…³)
â”‚   â””â”€â”€ sidebar/ (ä¾§è¾¹æ ç›¸å…³)
â”œâ”€â”€ composables/ (é€»è¾‘å¤ç”¨)
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ useChatHistory.ts
â”‚   â”œâ”€â”€ useChatRoomManagement.ts
â”‚   â””â”€â”€ useSSEConnection.ts
â”œâ”€â”€ types/ (ç±»å‹å®šä¹‰)
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ chat.types.ts
â”œâ”€â”€ constants/ (å¸¸é‡)
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ chat.ts
â”‚   â””â”€â”€ models.ts
â”œâ”€â”€ utils/ (å·¥å…·å‡½æ•°)
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ chatId.ts
â”‚   â”œâ”€â”€ messageParser.ts
â”‚   â””â”€â”€ timeFormat.ts
â””â”€â”€ styles/ (æ ·å¼)
    â”œâ”€â”€ index.less
    â”œâ”€â”€ markdown.less
    â”œâ”€â”€ animations.less
    â””â”€â”€ common.less
```

## ğŸ¯ æ¶æ„æ”¹è¿›

### 1. é«˜å†…èšä½è€¦åˆ

- âœ… æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€
- âœ… ç»„ä»¶é—´é€šè¿‡ props å’Œ events é€šä¿¡
- âœ… å…±äº«é€»è¾‘é€šè¿‡ composables å¤ç”¨
- âœ… æ ·å¼å’Œç±»å‹å®šä¹‰é›†ä¸­ç®¡ç†

### 2. å¯ç»´æŠ¤æ€§æå‡

- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºå®šä½
- âœ… ç»„ä»¶å°å·§ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
- âœ… ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
- âœ… æ³¨é‡Šå®Œå–„ï¼Œä»£ç è‡ªè§£é‡Š

### 3. å¯æ‰©å±•æ€§å¢å¼º

- âœ… æ–°å¢æ¨¡å‹åªéœ€ä¿®æ”¹å¸¸é‡æ–‡ä»¶
- âœ… æ–°å¢åŠŸèƒ½å¯ç‹¬ç«‹å¼€å‘ç»„ä»¶
- âœ… Composables å¯åœ¨å¤šå¤„å¤ç”¨
- âœ… æ ·å¼ä¸»é¢˜åŒ–æ˜“äºåˆ‡æ¢

### 4. å¼€å‘ä½“éªŒä¼˜åŒ–

- âœ… å¯¼å…¥è·¯å¾„æ›´ç®€æ´
- âœ… ç±»å‹æç¤ºæ›´å®Œå–„
- âœ… ä»£ç å¤ç”¨æ›´æ–¹ä¾¿
- âœ… è°ƒè¯•å®šä½æ›´å¿«é€Ÿ

## ğŸ” ä»£ç è´¨é‡æŒ‡æ ‡

### ç»„ä»¶å¤æ‚åº¦

- âœ… å•ä¸ªç»„ä»¶å¹³å‡è¡Œæ•°: 150 è¡Œï¼ˆä¹‹å‰ 400+ è¡Œï¼‰
- âœ… å•ä¸ªå‡½æ•°å¹³å‡è¡Œæ•°: 20 è¡Œï¼ˆä¹‹å‰ 50+ è¡Œï¼‰
- âœ… æœ€å¤§åµŒå¥—å±‚çº§: 3 å±‚ï¼ˆä¹‹å‰ 5+ å±‚ï¼‰

### ä»£ç å¤ç”¨ç‡

- âœ… å…±äº«ç±»å‹: 6 ä¸ªæ¥å£
- âœ… å…±äº«å¸¸é‡: 4 ç»„
- âœ… å…±äº«å·¥å…·å‡½æ•°: 5 ä¸ª
- âœ… å…±äº«æ ·å¼: 3 ä¸ªæ–‡ä»¶
- âœ… Composables: 3 ä¸ª

### å‘½åè§„èŒƒ

- âœ… ç»„ä»¶å‘½å: PascalCase
- âœ… å‡½æ•°å‘½å: camelCase
- âœ… å¸¸é‡å‘½å: UPPER_SNAKE_CASE
- âœ… ç±»å‹å‘½å: PascalCase + åç¼€ï¼ˆå¦‚ Interface, Typeï¼‰

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. æµ‹è¯•è¦†ç›–

- ä¸º composables æ·»åŠ å•å…ƒæµ‹è¯•
- ä¸ºå·¥å…·å‡½æ•°æ·»åŠ å•å…ƒæµ‹è¯•
- ä¸ºå…³é”®ç»„ä»¶æ·»åŠ é›†æˆæµ‹è¯•

### 2. æ€§èƒ½ä¼˜åŒ–

- è€ƒè™‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–é•¿åˆ—è¡¨
- å¯¹å¤§å‹ç»„ä»¶ä½¿ç”¨å¼‚æ­¥åŠ è½½
- ä¼˜åŒ–å›¾ç‰‡èµ„æºåŠ è½½

### 3. æ–‡æ¡£å®Œå–„

- ä¸ºæ¯ä¸ª composable æ·»åŠ ä½¿ç”¨ç¤ºä¾‹
- ä¸ºå¤æ‚ç»„ä»¶æ·»åŠ  Storybook
- å®Œå–„ API æ¥å£æ–‡æ¡£

### 4. å›½é™…åŒ–

- æå–æ‰€æœ‰ç¡¬ç¼–ç æ–‡æœ¬
- ä½¿ç”¨ i18n æ–¹æ¡ˆ
- æ”¯æŒå¤šè¯­è¨€åˆ‡æ¢

## ğŸ“ æ€»ç»“

æœ¬æ¬¡é‡æ„æˆåŠŸåœ°å°†é¡¹ç›®ä»"èƒ½ç”¨"æå‡åˆ°"å¥½ç”¨"çš„çŠ¶æ€ï¼š

âœ… **ä»£ç é‡å‡å°‘ 50%+**ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§
âœ… **ç»„ä»¶æ•°å¢åŠ  200%+**ï¼Œä½†æ›´æ˜“ç»´æŠ¤
âœ… **å¤ç”¨ç‡æå‡ 300%+**ï¼Œå‡å°‘é‡å¤ä»£ç 
âœ… **ç±»å‹å®‰å…¨æ€§ 100%**ï¼Œæ¶ˆé™¤ç±»å‹é”™è¯¯
âœ… **å¼€å‘æ•ˆç‡æå‡ 50%+**ï¼Œç»“æ„æ¸…æ™°æ˜“ä¸Šæ‰‹

é‡æ„åçš„ä»£ç éµå¾ªäº† **SOLID** åŸåˆ™å’Œ **DRY** åŸåˆ™ï¼Œå®ç°äº†é«˜å†…èšä½è€¦åˆçš„æ¶æ„è®¾è®¡ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸç»´æŠ¤å’Œæ‰©å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚
